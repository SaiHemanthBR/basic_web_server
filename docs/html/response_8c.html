<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nanows: slib/response.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">nanows
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">A simple web server written in C using POSIX Sockets.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('response_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">response.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions for creating, sending and handling network responses.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="response_8h_source.html">response.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa544d3cb48f8783239a33b61ca362208"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structresponse.html">response</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#aa544d3cb48f8783239a33b61ca362208">create_response</a> (const int conn_fd)</td></tr>
<tr class="memdesc:aa544d3cb48f8783239a33b61ca362208"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a response struct, duplicates <code>conn_fd</code> and returns a pointer to the response struct.  <a href="response_8c.html#aa544d3cb48f8783239a33b61ca362208">More...</a><br /></td></tr>
<tr class="separator:aa544d3cb48f8783239a33b61ca362208"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a741ba120c3816e5c141f443498fb7a53"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structresponse.html">response</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#a741ba120c3816e5c141f443498fb7a53">create_response_from_request</a> (const <a class="el" href="structrequest.html">request</a> *req)</td></tr>
<tr class="memdesc:a741ba120c3816e5c141f443498fb7a53"><td class="mdescLeft">&#160;</td><td class="mdescRight">Similar to <code><a class="el" href="response_8h.html#ae7d74802599dbf4ec67da54b727cf48f" title="Creates a response struct, duplicates conn_fd and returns a pointer to the response struct.">create_response()</a></code>, but takes a request struct as an argument and copies <code>http_ver</code> from the request struct.  <a href="response_8c.html#a741ba120c3816e5c141f443498fb7a53">More...</a><br /></td></tr>
<tr class="separator:a741ba120c3816e5c141f443498fb7a53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2da660d38d8430c6d33f62609671459c"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#a2da660d38d8430c6d33f62609671459c">get_response_header</a> (const <a class="el" href="structresponse.html">response</a> *res, const char *header_key, char *header_val)</td></tr>
<tr class="memdesc:a2da660d38d8430c6d33f62609671459c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the value of the response header for the given key.  <a href="response_8c.html#a2da660d38d8430c6d33f62609671459c">More...</a><br /></td></tr>
<tr class="separator:a2da660d38d8430c6d33f62609671459c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a134a5b65399e2c4eabf8b08b976beade"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#a134a5b65399e2c4eabf8b08b976beade">set_response_header</a> (const <a class="el" href="structresponse.html">response</a> *res, const char *header_key, const char *header_val)</td></tr>
<tr class="memdesc:a134a5b65399e2c4eabf8b08b976beade"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the value of the response header for the given key.  <a href="response_8c.html#a134a5b65399e2c4eabf8b08b976beade">More...</a><br /></td></tr>
<tr class="separator:a134a5b65399e2c4eabf8b08b976beade"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cddc23bfce5a8c91a3bcb08a32a5404"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#a0cddc23bfce5a8c91a3bcb08a32a5404">send_response_head</a> (const <a class="el" href="structresponse.html">response</a> *res)</td></tr>
<tr class="memdesc:a0cddc23bfce5a8c91a3bcb08a32a5404"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the response head (Start line and headers) to the client.  <a href="response_8c.html#a0cddc23bfce5a8c91a3bcb08a32a5404">More...</a><br /></td></tr>
<tr class="separator:a0cddc23bfce5a8c91a3bcb08a32a5404"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a5c10ccac66fcf379900cc82afc0603"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#a1a5c10ccac66fcf379900cc82afc0603">send_response_file</a> (const <a class="el" href="structresponse.html">response</a> *res, FILE *file)</td></tr>
<tr class="memdesc:a1a5c10ccac66fcf379900cc82afc0603"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends data in a <code>FILE</code> stream to the client as response body.  <a href="response_8c.html#a1a5c10ccac66fcf379900cc82afc0603">More...</a><br /></td></tr>
<tr class="separator:a1a5c10ccac66fcf379900cc82afc0603"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ed3d9fb684e7e66caf2d360b07d21c9"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#a0ed3d9fb684e7e66caf2d360b07d21c9">send_response</a> (const <a class="el" href="structresponse.html">response</a> *res, const char *buf, ssize_t buf_size)</td></tr>
<tr class="memdesc:a0ed3d9fb684e7e66caf2d360b07d21c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends first <code>buf_size</code> bytes in <code>buf</code> to the client as response body.  <a href="response_8c.html#a0ed3d9fb684e7e66caf2d360b07d21c9">More...</a><br /></td></tr>
<tr class="separator:a0ed3d9fb684e7e66caf2d360b07d21c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ff953f6c5c1845c681a54abb2b9d31a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#a8ff953f6c5c1845c681a54abb2b9d31a">close_response</a> (<a class="el" href="structresponse.html">response</a> *res)</td></tr>
<tr class="memdesc:a8ff953f6c5c1845c681a54abb2b9d31a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes the response connection and frees the response struct.  <a href="response_8c.html#a8ff953f6c5c1845c681a54abb2b9d31a">More...</a><br /></td></tr>
<tr class="separator:a8ff953f6c5c1845c681a54abb2b9d31a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78e28d1f68111539fbffaee3cb9a9446"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structresponse.html">response</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#a78e28d1f68111539fbffaee3cb9a9446">_initialize_response</a> ()</td></tr>
<tr class="memdesc:a78e28d1f68111539fbffaee3cb9a9446"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates memory for a response struct and initializes it to default values.  <a href="response_8c.html#a78e28d1f68111539fbffaee3cb9a9446">More...</a><br /></td></tr>
<tr class="separator:a78e28d1f68111539fbffaee3cb9a9446"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2327f09bd02c7c49a130a92a900e73f2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#a2327f09bd02c7c49a130a92a900e73f2">_free_response</a> (<a class="el" href="structresponse.html">response</a> *res)</td></tr>
<tr class="memdesc:a2327f09bd02c7c49a130a92a900e73f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to free the response struct.  <a href="response_8c.html#a2327f09bd02c7c49a130a92a900e73f2">More...</a><br /></td></tr>
<tr class="separator:a2327f09bd02c7c49a130a92a900e73f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3dc8e0084f8ed2bf1e22e3d1e97a98f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#ac3dc8e0084f8ed2bf1e22e3d1e97a98f">_res_header_htab_key_destroy</a> (gpointer data)</td></tr>
<tr class="memdesc:ac3dc8e0084f8ed2bf1e22e3d1e97a98f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases the memory allocated for the given key, called automatically by <code>g_hash_table_destroy()</code>.  <a href="response_8c.html#ac3dc8e0084f8ed2bf1e22e3d1e97a98f">More...</a><br /></td></tr>
<tr class="separator:ac3dc8e0084f8ed2bf1e22e3d1e97a98f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbd6efd303f572d33b350fdcdb921306"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="response_8c.html#abbd6efd303f572d33b350fdcdb921306">_res_header_htab_value_destroy</a> (gpointer data)</td></tr>
<tr class="memdesc:abbd6efd303f572d33b350fdcdb921306"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases the memory allocated for the given value, called automatically by <code>g_hash_table_destroy()</code>.  <a href="response_8c.html#abbd6efd303f572d33b350fdcdb921306">More...</a><br /></td></tr>
<tr class="separator:abbd6efd303f572d33b350fdcdb921306"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions for creating, sending and handling network responses. </p>
<p>Implements functions defined in <code><a class="el" href="response_8h.html" title="Function Prototypes for creating, sending and handling network responses.">include/response.h</a></code>. Used to create, send and handle network responses.</p>
<p>The structure of response is defined by <code>struct response</code> (defined in <code><a class="el" href="response_8h.html" title="Function Prototypes for creating, sending and handling network responses.">include/response.h</a></code>). This struct contains the following fields: http method, status code, response headers and connection file descriptor. <code>struct response</code> is used to send the response back to the client and can be created by manually calling <code><a class="el" href="response_8c.html#aa544d3cb48f8783239a33b61ca362208" title="Creates a response struct, duplicates conn_fd and returns a pointer to the response struct.">create_response()</a></code> function and setting the values or automatically from a request.</p>
<p>Max size of a response header when formatted as "&lt;key&gt;: &lt;value&gt;\r\n" is defined by <code>RES_HEADER_BUF_SIZE</code> macro (defined in <code><a class="el" href="response_8h.html" title="Function Prototypes for creating, sending and handling network responses.">include/response.h</a></code>). This value can be changed by defining <code>RES_HEADER_BUF_SIZE</code> before <code>#include "response.h"</code>.</p>
<dl class="section see"><dt>See also</dt><dd>typedef struct <a class="el" href="structrequest.html" title="Defines a request structure.">request</a> </dd>
<dd>
typedef struct <a class="el" href="structresponse.html" title="Defines a rresponse structure.">response</a> </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Sai Hemanth Bheemreddy (@SaiHemanthBR) </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>MIT License; Copyright (c) 2021 Sai Hemanth Bheemreddy </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000010">Bug:</a></b></dt><dd>No known bugs. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a2327f09bd02c7c49a130a92a900e73f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2327f09bd02c7c49a130a92a900e73f2">&#9670;&nbsp;</a></span>_free_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _free_response </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structresponse.html">response</a> *&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to free the response struct. </p>
<p>This function frees the memory allocated for the response struct. This includes freeing the memory allocated for GHashTable using <code>g_hash_table_destroy()</code> and freeing the memory allocated to <code>http_ver</code> and <code>status_code</code> using <code>free()</code>. Once the request struct is freed, <code>res</code> parameter is set to <code>NULL</code>. If a <code>NULL</code> pointer is passed to this function, function does nothing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">res</td><td>The response struct to be freed and set to <code>NULL</code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a78e28d1f68111539fbffaee3cb9a9446"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78e28d1f68111539fbffaee3cb9a9446">&#9670;&nbsp;</a></span>_initialize_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structresponse.html">response</a>* _initialize_response </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates memory for a response struct and initializes it to default values. </p>
<p>Default values are:</p><ul>
<li>conn_fd = -1</li>
<li>http_ver = <code>NULL</code></li>
<li>status_code = <code>NULL</code></li>
<li>header_htab = pointer to a newly allocated <code>GHashTable</code></li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>On success, pointer to a newly allocated request struct is returned. On failure, <code>NULL</code> is returned. </dd></dl>

</div>
</div>
<a id="ac3dc8e0084f8ed2bf1e22e3d1e97a98f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3dc8e0084f8ed2bf1e22e3d1e97a98f">&#9670;&nbsp;</a></span>_res_header_htab_key_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _res_header_htab_key_destroy </td>
          <td>(</td>
          <td class="paramtype">gpointer&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Releases the memory allocated for the given key, called automatically by <code>g_hash_table_destroy()</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Pointer to key in the hash table. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="abbd6efd303f572d33b350fdcdb921306"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abbd6efd303f572d33b350fdcdb921306">&#9670;&nbsp;</a></span>_res_header_htab_value_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _res_header_htab_value_destroy </td>
          <td>(</td>
          <td class="paramtype">gpointer&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Releases the memory allocated for the given value, called automatically by <code>g_hash_table_destroy()</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Pointer to value in the hash table. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a8ff953f6c5c1845c681a54abb2b9d31a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ff953f6c5c1845c681a54abb2b9d31a">&#9670;&nbsp;</a></span>close_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void close_response </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structresponse.html">response</a> *&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes the response connection and frees the response struct. </p>
<p>All response connections needed to be closed after sending the response. Even if the response connection is closed, the browser will still wait for resquest connection to be closed. Therefore, this function, along with <code>close_request</code>, must be called to complete the request-response cycle. This function calls <code>_free_response</code> to free the request struct.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">req</td><td>The response to be closed and freed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="request_8c.html#aee96499e88370e463617a24dada68234" title="Closes the request connection and frees the request struct.">close_request</a> </dd>
<dd>
<a class="el" href="response_8h.html#aafdf3df2439747917aa7a21658678cea" title="Helper function to free the response struct.">_free_response</a> </dd></dl>

</div>
</div>
<a id="aa544d3cb48f8783239a33b61ca362208"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa544d3cb48f8783239a33b61ca362208">&#9670;&nbsp;</a></span>create_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structresponse.html">response</a>* create_response </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>conn_fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a response struct, duplicates <code>conn_fd</code> and returns a pointer to the response struct. </p>
<p>This function allocates memory for a response struct by calling <code>_initialize_response</code>, duplicates <code>conn_fd</code> using <code>dup()</code> and returns a pointer to the response struct. <code>conn_fd</code> is duplicated to prevent from user closing the original connection file descriptor and leaving the response struct in an invalid state. (e.g. <code>conn_fd</code> is closed, but the response struct is still in use by the user, this causes errors when the user tries to send the response back to the client).</p>
<p>For, more info about <code>dup()</code>, see docs/man pages for <code>unistd.h</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn_fd</td><td>The file descriptor of the connection that will be used to send the response. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, a pointer to the response struct is returned. On failure, <code>NULL</code> is returned.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="response_8h.html#a78e28d1f68111539fbffaee3cb9a9446" title="Allocates memory for a response struct and initializes it to default values.">_initialize_response</a> </dd></dl>

</div>
</div>
<a id="a741ba120c3816e5c141f443498fb7a53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a741ba120c3816e5c141f443498fb7a53">&#9670;&nbsp;</a></span>create_response_from_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structresponse.html">response</a>* create_response_from_request </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrequest.html">request</a> *&#160;</td>
          <td class="paramname"><em>req</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Similar to <code><a class="el" href="response_8h.html#ae7d74802599dbf4ec67da54b727cf48f" title="Creates a response struct, duplicates conn_fd and returns a pointer to the response struct.">create_response()</a></code>, but takes a request struct as an argument and copies <code>http_ver</code> from the request struct. </p>
<p>This function is similar to <code><a class="el" href="response_8h.html#ae7d74802599dbf4ec67da54b727cf48f" title="Creates a response struct, duplicates conn_fd and returns a pointer to the response struct.">create_response()</a></code>, and uses <code><a class="el" href="response_8h.html#ae7d74802599dbf4ec67da54b727cf48f" title="Creates a response struct, duplicates conn_fd and returns a pointer to the response struct.">create_response()</a></code> internally, except that it takes a request struct as an argument and also copies <code>http_ver</code> from the request struct. <code>http_ver</code> is a freshly allocated string and is independent of <code>request:http_ver</code>. It is adviced to use <code><a class="el" href="response_8h.html#a68ec837897bd5779f1ba5dd7cfd457a3" title="Similar to create_response(), but takes a request struct as an argument and copies http_ver from the ...">create_response_from_request()</a></code> instead of <code><a class="el" href="response_8h.html#ae7d74802599dbf4ec67da54b727cf48f" title="Creates a response struct, duplicates conn_fd and returns a pointer to the response struct.">create_response()</a></code> if you are using a request struct.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">req</td><td>The request struct that will be used to create the response. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, a pointer to the response struct is returned. On failure, <code>NULL</code> is returned.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="response_8h.html#ae7d74802599dbf4ec67da54b727cf48f" title="Creates a response struct, duplicates conn_fd and returns a pointer to the response struct.">create_response</a> </dd></dl>

</div>
</div>
<a id="a2da660d38d8430c6d33f62609671459c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2da660d38d8430c6d33f62609671459c">&#9670;&nbsp;</a></span>get_response_header()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* get_response_header </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structresponse.html">response</a> *&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>header_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>header_val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the value of the response header for the given key. </p>
<p>If <code>header_key</code> is found in header table, the value is copied into <code>header_val</code> and the same is returned. If the key is not found or an error occurs, <code>NULL</code> is returned and <code>header_val</code> is not modified.</p>
<p><code>header_val</code> can be <code>NULL</code>, in which case, the function simply returns the value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">res</td><td>The response struct. </td></tr>
    <tr><td class="paramname">header_key</td><td>The key of the header. </td></tr>
    <tr><td class="paramname">header_val</td><td>Pointer to a string to store the value of the header. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, returns a pointer to the header value. On failure, returns <code>NULL</code>. </dd></dl>

</div>
</div>
<a id="a0ed3d9fb684e7e66caf2d360b07d21c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ed3d9fb684e7e66caf2d360b07d21c9">&#9670;&nbsp;</a></span>send_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t send_response </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structresponse.html">response</a> *&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>buf_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends first <code>buf_size</code> bytes in <code>buf</code> to the client as response body. </p>
<p>If <code>buf_size</code> is given as '-1', the function sends the entire buffer <code>buf</code> to the client as response body (i.e. until <code>\0</code> is reached). On success, the function returns the number of bytes sent. On failure, returns <code>-1</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">res</td><td>The response struct. </td></tr>
    <tr><td class="paramname">buf</td><td>The buffer to be sent as response body to the client. </td></tr>
    <tr><td class="paramname">buf_size</td><td>The number of bytes to be sent (-1 if the entire buffer <code>buf</code> is to be sent). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, returns the number of bytes sent. On failure, returns <code>-1</code>. </dd></dl>

</div>
</div>
<a id="a1a5c10ccac66fcf379900cc82afc0603"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a5c10ccac66fcf379900cc82afc0603">&#9670;&nbsp;</a></span>send_response_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t send_response_file </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structresponse.html">response</a> *&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends data in a <code>FILE</code> stream to the client as response body. </p>
<p>This function sends the response body from the <code>FILE</code> stream <code>file</code> to the client. The file is read using (<code>fread()</code> as chunks of size <code>RES_BUF_SIZE</code> and sent to the client. If the number of bytes read from the file doesn't match the number of bytes sent to the client, it is considered an error and the function returns total number of bytes that were sent before the error occurred.</p>
<p>The function doesn't send response head (Start line and headers) to the client, it is assumed that the client has already received the response head. The file stream is assumed to be opened in <code>"rb"</code> mode and is not closed by this function after sending the response.</p>
<p>For now, the only way to make sure the file has been sucessfully sent to the client is to check the returned number of bytes with the actual byte size of the file. This is a known limitation and will be fixed in the future.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">res</td><td>The response struct. </td></tr>
    <tr><td class="paramname">file</td><td>The <code>FILE</code> stream to be sent as response body to the client. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the number of bytes sent. If an error occurs, returns the number of bytes that were sent before the error occurred. </dd></dl>

</div>
</div>
<a id="a0cddc23bfce5a8c91a3bcb08a32a5404"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cddc23bfce5a8c91a3bcb08a32a5404">&#9670;&nbsp;</a></span>send_response_head()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t send_response_head </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structresponse.html">response</a> *&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends the response head (Start line and headers) to the client. </p>
<p>This function sends the response start line, followed by the all the response headers set in header table for the response <code>res</code> and an empty line to separate the response head from the response body. This function must be called before sending the response body (i.e., <code><a class="el" href="response_8h.html#a464c917b026297025ed5c6c448816244" title="Sends data in a FILE stream to the client as response body.">send_response_file()</a></code> or <code><a class="el" href="response_8h.html#a08ce63484bd17225366035db410023ae" title="Sends first buf_size bytes in buf to the client as response body.">send_response()</a></code>).)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">res</td><td>The response struct. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the number of bytes sent. If an error occurs, returns the number of bytes that were sent before the error occurred. </dd></dl>

</div>
</div>
<a id="a134a5b65399e2c4eabf8b08b976beade"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a134a5b65399e2c4eabf8b08b976beade">&#9670;&nbsp;</a></span>set_response_header()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* set_response_header </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structresponse.html">response</a> *&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>header_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>header_val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the value of the response header for the given key. </p>
<p>If <code>header_key</code> is not found in header table, <code>header_key</code> is added to the header table with value <code>header_val</code>. If <code>header_key</code> is found in header table, <code>NULL</code> is returned and value in header table is not modified. If an error occurs, <code>NULL</code> is returned and header table is not modified.</p>
<p><code>header_key</code> and <code>header_val</code> are duplicated using <code>strdup()</code> before storing in header table, this is done to prevent from user freeing the original values and leaving dandling pointers in the header table. The freshly allocated strings are freed interally and the user should not free them.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">res</td><td>The response struct. </td></tr>
    <tr><td class="paramname">header_key</td><td>The key for the header. </td></tr>
    <tr><td class="paramname">header_val</td><td>Header value to be set. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, returns <code>header_val</code> that was stored. On failure, returns <code>NULL</code>. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_a4675acfa3d30a88614d0e29f4f99e5f.html">slib</a></li><li class="navelem"><a class="el" href="response_8c.html">response.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
