<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nanows: slib/server.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">nanows
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">A simple web server written in C using POSIX Sockets.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('server_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">server.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions for loading configuration, starting and stopping the server, memory management and for handling the server's main loop.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;arpa/inet.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;netinet/in.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="server_8h_source.html">server.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af2693a5bca6590f846d4c29004b740ce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#af2693a5bca6590f846d4c29004b740ce">start_server</a> ()</td></tr>
<tr class="memdesc:af2693a5bca6590f846d4c29004b740ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads the config, sets up the server and starts the main loop.  <a href="server_8c.html#af2693a5bca6590f846d4c29004b740ce">More...</a><br /></td></tr>
<tr class="separator:af2693a5bca6590f846d4c29004b740ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ac817bfeed2cc83598aa74059dd7aef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#a1ac817bfeed2cc83598aa74059dd7aef">stop_server</a> ()</td></tr>
<tr class="memdesc:a1ac817bfeed2cc83598aa74059dd7aef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops the server and free all the resources.  <a href="server_8c.html#a1ac817bfeed2cc83598aa74059dd7aef">More...</a><br /></td></tr>
<tr class="separator:a1ac817bfeed2cc83598aa74059dd7aef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbc6ffa7bcb06eca9c3738d98f1d51e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#afbc6ffa7bcb06eca9c3738d98f1d51e8">setup_socket</a> ()</td></tr>
<tr class="memdesc:afbc6ffa7bcb06eca9c3738d98f1d51e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up the server's POSIX socket.  <a href="server_8c.html#afbc6ffa7bcb06eca9c3738d98f1d51e8">More...</a><br /></td></tr>
<tr class="separator:afbc6ffa7bcb06eca9c3738d98f1d51e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f469248b11d50e109af00b86ae82bb6"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#a6f469248b11d50e109af00b86ae82bb6">handle_request</a> (void *new_conn_fd)</td></tr>
<tr class="memdesc:a6f469248b11d50e109af00b86ae82bb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the client requests.  <a href="server_8c.html#a6f469248b11d50e109af00b86ae82bb6">More...</a><br /></td></tr>
<tr class="separator:a6f469248b11d50e109af00b86ae82bb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea07360538c7459f258ca63bde7a5767"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#aea07360538c7459f258ca63bde7a5767">clean_request</a> (FILE *file, <a class="el" href="structrequest.html">request</a> *req, <a class="el" href="structresponse.html">response</a> *res)</td></tr>
<tr class="memdesc:aea07360538c7459f258ca63bde7a5767"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes file stream, requests and response objects and free memory allocated for them.  <a href="server_8c.html#aea07360538c7459f258ca63bde7a5767">More...</a><br /></td></tr>
<tr class="separator:aea07360538c7459f258ca63bde7a5767"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a58bcdde21e0687d1b5634b673451357a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8c.html#a58bcdde21e0687d1b5634b673451357a">tcp_socket</a> = -1</td></tr>
<tr class="memdesc:a58bcdde21e0687d1b5634b673451357a"><td class="mdescLeft">&#160;</td><td class="mdescRight">File descriptor for the server socket used to listen for incoming connections.  <a href="server_8c.html#a58bcdde21e0687d1b5634b673451357a">More...</a><br /></td></tr>
<tr class="separator:a58bcdde21e0687d1b5634b673451357a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions for loading configuration, starting and stopping the server, memory management and for handling the server's main loop. </p>
<p>Implements functions defined in <code><a class="el" href="server_8h.html" title="Function prototypes for the server functions.">include/server.h</a></code>. Used to load configuration, start and stop the server, memory management and for handling the server's main loop.</p>
<dl class="section author"><dt>Author</dt><dd>Sai Hemanth Bheemreddy (@SaiHemanthBR) </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>MIT License; Copyright (c) 2021 Sai Hemanth Bheemreddy </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000012">Bug:</a></b></dt><dd>No known bugs. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aea07360538c7459f258ca63bde7a5767"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea07360538c7459f258ca63bde7a5767">&#9670;&nbsp;</a></span>clean_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clean_request </td>
          <td>(</td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrequest.html">request</a> *&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structresponse.html">response</a> *&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes file stream, requests and response objects and free memory allocated for them. </p>
<p>If <code>file</code> or <code>req</code> or <code>resp</code> is <code>NULL</code>, then no action is taken. This helps in cases where only one or two of the objects are allocated and needed to be freed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>File stream to be closed. </td></tr>
    <tr><td class="paramname">req</td><td>Request object to be closed. </td></tr>
    <tr><td class="paramname">res</td><td>Response object to be closed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a6f469248b11d50e109af00b86ae82bb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f469248b11d50e109af00b86ae82bb6">&#9670;&nbsp;</a></span>handle_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* handle_request </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>new_conn_fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the client requests. </p>
<p>This function is called by the main loop on a new thread for each connection. It handles the client requests and sends the response back to the client. The file descriptor for the client is passed as an pointer to the function by <code>pthread_create()</code>. The thread is detached after it is created. So, the resources must be freed before the thread exits.</p>
<p>If any error occurs, returns a non-zero value. On success, returns 0. This return value is currently unused.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_conn_fd</td><td>Pointer to the file descriptor of the new connection. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="afbc6ffa7bcb06eca9c3738d98f1d51e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbc6ffa7bcb06eca9c3738d98f1d51e8">&#9670;&nbsp;</a></span>setup_socket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_socket </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up the server's POSIX socket. </p>
<p>Creates a TCP socket and binds it to the host and port specified in the config file. On success, it sets <code>tcp_socket</code> file descriptor to the socket created and returns. On failure, it exits with exit code -1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af2693a5bca6590f846d4c29004b740ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2693a5bca6590f846d4c29004b740ce">&#9670;&nbsp;</a></span>start_server()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void start_server </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads the config, sets up the server and starts the main loop. </p>
<p>This function is the entry point for the server. It loads the config, sets up the server socket and enters the main loop. This function never returns unless an error occurs or signalled by OS. The server main loop runs on main thread and creates a new thread for each connection. Requests are handled by the <code><a class="el" href="server_8h.html#aa79ed64bcb0ddd36484789820e639ba7" title="Handles the client requests.">handle_request()</a></code> function on the newly created thread.</p>
<dl class="section return"><dt>Returns</dt><dd>Never returns unless an error occurs or signalled by OS. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="server_8h.html#aa79ed64bcb0ddd36484789820e639ba7" title="Handles the client requests.">handle_request()</a> </dd></dl>

</div>
</div>
<a id="a1ac817bfeed2cc83598aa74059dd7aef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ac817bfeed2cc83598aa74059dd7aef">&#9670;&nbsp;</a></span>stop_server()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stop_server </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops the server and free all the resources. </p>
<p>This function should be called when the server is no longer needed. It stops the server, closes the server socket, unloads config and mime types hash table and frees all the resources.</p>
<p>This function must be called before the program exits to ensure all the resources are freed. Recommended to call this function from <code>atexit()</code> function and as signal handler using <code>signal()</code> function.</p>
<p>If <code><a class="el" href="server_8h.html#a1ac817bfeed2cc83598aa74059dd7aef" title="Stops the server and free all the resources.">stop_server()</a></code> is called before <code><a class="el" href="server_8h.html#af2693a5bca6590f846d4c29004b740ce" title="Loads the config, sets up the server and starts the main loop.">start_server()</a></code>, it does nothing.</p>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a58bcdde21e0687d1b5634b673451357a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58bcdde21e0687d1b5634b673451357a">&#9670;&nbsp;</a></span>tcp_socket</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int tcp_socket = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>File descriptor for the server socket used to listen for incoming connections. </p>
<p>Initially set to -1. Once the server is started and a socket is created, this file descriptor is set to the socket's file descriptor.</p>
<p>This is a private object and should not be accessed directly. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_a4675acfa3d30a88614d0e29f4f99e5f.html">slib</a></li><li class="navelem"><a class="el" href="server_8c.html">server.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
