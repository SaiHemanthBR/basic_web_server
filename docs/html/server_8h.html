<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nanows: include/server.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">nanows
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">A simple web server written in C using POSIX Sockets.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('server_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">server.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Function prototypes for the server functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="mimetypes_8h_source.html">mimetypes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="request_8h_source.html">request.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="response_8h_source.html">response.h</a>&quot;</code><br />
</div>
<p><a href="server_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aeefbbafa97642defe3ee6c3080b7d66f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8h.html#aeefbbafa97642defe3ee6c3080b7d66f">BACKLOG</a>&#160;&#160;&#160;16</td></tr>
<tr class="memdesc:aeefbbafa97642defe3ee6c3080b7d66f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the maximum legnth for the queue of pending connnections, passed to <code>listen()</code> function.  <a href="server_8h.html#aeefbbafa97642defe3ee6c3080b7d66f">More...</a><br /></td></tr>
<tr class="separator:aeefbbafa97642defe3ee6c3080b7d66f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af00aa3c79fe31d435739c34e4c989835"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8h.html#af00aa3c79fe31d435739c34e4c989835">SERVER_NAME</a>&#160;&#160;&#160;&quot;ElServe/2.0&quot;</td></tr>
<tr class="memdesc:af00aa3c79fe31d435739c34e4c989835"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the value for value for <code>Server</code> response header.  <a href="server_8h.html#af00aa3c79fe31d435739c34e4c989835">More...</a><br /></td></tr>
<tr class="separator:af00aa3c79fe31d435739c34e4c989835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a184212cb673a00fc691417cd6bb9e10c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8h.html#a184212cb673a00fc691417cd6bb9e10c">FILE_PATH_BUF_SIZE</a>&#160;&#160;&#160;1024</td></tr>
<tr class="memdesc:a184212cb673a00fc691417cd6bb9e10c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the maximum length of path for website root directory.  <a href="server_8h.html#a184212cb673a00fc691417cd6bb9e10c">More...</a><br /></td></tr>
<tr class="separator:a184212cb673a00fc691417cd6bb9e10c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af2693a5bca6590f846d4c29004b740ce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8h.html#af2693a5bca6590f846d4c29004b740ce">start_server</a> ()</td></tr>
<tr class="memdesc:af2693a5bca6590f846d4c29004b740ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads the config, sets up the server and starts the main loop.  <a href="server_8h.html#af2693a5bca6590f846d4c29004b740ce">More...</a><br /></td></tr>
<tr class="separator:af2693a5bca6590f846d4c29004b740ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ac817bfeed2cc83598aa74059dd7aef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8h.html#a1ac817bfeed2cc83598aa74059dd7aef">stop_server</a> ()</td></tr>
<tr class="memdesc:a1ac817bfeed2cc83598aa74059dd7aef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops the server and free all the resources.  <a href="server_8h.html#a1ac817bfeed2cc83598aa74059dd7aef">More...</a><br /></td></tr>
<tr class="separator:a1ac817bfeed2cc83598aa74059dd7aef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbc6ffa7bcb06eca9c3738d98f1d51e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8h.html#afbc6ffa7bcb06eca9c3738d98f1d51e8">setup_socket</a> ()</td></tr>
<tr class="memdesc:afbc6ffa7bcb06eca9c3738d98f1d51e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up the server's POSIX socket.  <a href="server_8h.html#afbc6ffa7bcb06eca9c3738d98f1d51e8">More...</a><br /></td></tr>
<tr class="separator:afbc6ffa7bcb06eca9c3738d98f1d51e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa79ed64bcb0ddd36484789820e639ba7"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8h.html#aa79ed64bcb0ddd36484789820e639ba7">handle_request</a> (void *)</td></tr>
<tr class="memdesc:aa79ed64bcb0ddd36484789820e639ba7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the client requests.  <a href="server_8h.html#aa79ed64bcb0ddd36484789820e639ba7">More...</a><br /></td></tr>
<tr class="separator:aa79ed64bcb0ddd36484789820e639ba7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dac82030da7779c7b2b20d6bbe6b748"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="server_8h.html#a0dac82030da7779c7b2b20d6bbe6b748">clean_request</a> (FILE *, <a class="el" href="structrequest.html">request</a> *, <a class="el" href="structresponse.html">response</a> *)</td></tr>
<tr class="memdesc:a0dac82030da7779c7b2b20d6bbe6b748"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes file stream, requests and response objects and free memory allocated for them.  <a href="server_8h.html#a0dac82030da7779c7b2b20d6bbe6b748">More...</a><br /></td></tr>
<tr class="separator:a0dac82030da7779c7b2b20d6bbe6b748"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Function prototypes for the server functions. </p>
<p>This file contains function prototypes for loading configuration, starting and stopping the server, memory management and for handling the server's main loop.</p>
<dl class="section author"><dt>Author</dt><dd>Sai Hemanth Bheemreddy (@SaiHemanthBR) </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>MIT License; Copyright (c) 2021 Sai Hemanth Bheemreddy </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000006">Bug:</a></b></dt><dd>No known bugs. </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aeefbbafa97642defe3ee6c3080b7d66f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeefbbafa97642defe3ee6c3080b7d66f">&#9670;&nbsp;</a></span>BACKLOG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BACKLOG&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Defines the maximum legnth for the queue of pending connnections, passed to <code>listen()</code> function. </p>
<p>For more Info about <code>backlog</code> parameter in <code>listen()</code> function, please refer to POSIX Sockets Docs. </p>

</div>
</div>
<a id="a184212cb673a00fc691417cd6bb9e10c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a184212cb673a00fc691417cd6bb9e10c">&#9670;&nbsp;</a></span>FILE_PATH_BUF_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FILE_PATH_BUF_SIZE&#160;&#160;&#160;1024</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Defines the maximum length of path for website root directory. </p>
<p>In config file, the length of value for key defined by <code>SITE_DIR_CONF_KEY</code> macro (default: <code>site_root_dir</code>) should not exceed this value.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="config_8h.html#ade8b85f60f40c77aaa098e17040ec1f8" title="Defines the default configuration key for website root directory.">SITE_DIR_CONF_KEY</a> </dd></dl>

</div>
</div>
<a id="af00aa3c79fe31d435739c34e4c989835"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af00aa3c79fe31d435739c34e4c989835">&#9670;&nbsp;</a></span>SERVER_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SERVER_NAME&#160;&#160;&#160;&quot;ElServe/2.0&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Defines the value for value for <code>Server</code> response header. </p>
<dl class="section see"><dt>See also</dt><dd><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Server">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Server</a> </dd></dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0dac82030da7779c7b2b20d6bbe6b748"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dac82030da7779c7b2b20d6bbe6b748">&#9670;&nbsp;</a></span>clean_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clean_request </td>
          <td>(</td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrequest.html">request</a> *&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structresponse.html">response</a> *&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes file stream, requests and response objects and free memory allocated for them. </p>
<p>If <code>file</code> or <code>req</code> or <code>resp</code> is <code>NULL</code>, then no action is taken. This helps in cases where only one or two of the objects are allocated and needed to be freed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>File stream to be closed. </td></tr>
    <tr><td class="paramname">req</td><td>Request object to be closed. </td></tr>
    <tr><td class="paramname">res</td><td>Response object to be closed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="aa79ed64bcb0ddd36484789820e639ba7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa79ed64bcb0ddd36484789820e639ba7">&#9670;&nbsp;</a></span>handle_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* handle_request </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>new_conn_fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the client requests. </p>
<p>This function is called by the main loop on a new thread for each connection. It handles the client requests and sends the response back to the client. The file descriptor for the client is passed as an pointer to the function by <code>pthread_create()</code>. The thread is detached after it is created. So, the resources must be freed before the thread exits.</p>
<p>If any error occurs, returns a non-zero value. On success, returns 0. This return value is currently unused.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_conn_fd</td><td>Pointer to the file descriptor of the new connection. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="afbc6ffa7bcb06eca9c3738d98f1d51e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbc6ffa7bcb06eca9c3738d98f1d51e8">&#9670;&nbsp;</a></span>setup_socket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_socket </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up the server's POSIX socket. </p>
<p>Creates a TCP socket and binds it to the host and port specified in the config file. On success, it sets <code>tcp_socket</code> file descriptor to the socket created and returns. On failure, it exits with exit code -1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af2693a5bca6590f846d4c29004b740ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2693a5bca6590f846d4c29004b740ce">&#9670;&nbsp;</a></span>start_server()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void start_server </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads the config, sets up the server and starts the main loop. </p>
<p>This function is the entry point for the server. It loads the config, sets up the server socket and enters the main loop. This function never returns unless an error occurs or signalled by OS. The server main loop runs on main thread and creates a new thread for each connection. Requests are handled by the <code><a class="el" href="server_8h.html#aa79ed64bcb0ddd36484789820e639ba7" title="Handles the client requests.">handle_request()</a></code> function on the newly created thread.</p>
<dl class="section return"><dt>Returns</dt><dd>Never returns unless an error occurs or signalled by OS. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="server_8h.html#aa79ed64bcb0ddd36484789820e639ba7" title="Handles the client requests.">handle_request()</a> </dd></dl>

</div>
</div>
<a id="a1ac817bfeed2cc83598aa74059dd7aef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ac817bfeed2cc83598aa74059dd7aef">&#9670;&nbsp;</a></span>stop_server()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stop_server </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops the server and free all the resources. </p>
<p>This function should be called when the server is no longer needed. It stops the server, closes the server socket, unloads config and mime types hash table and frees all the resources.</p>
<p>This function must be called before the program exits to ensure all the resources are freed. Recommended to call this function from <code>atexit()</code> function and as signal handler using <code>signal()</code> function.</p>
<p>If <code><a class="el" href="server_8h.html#a1ac817bfeed2cc83598aa74059dd7aef" title="Stops the server and free all the resources.">stop_server()</a></code> is called before <code><a class="el" href="server_8h.html#af2693a5bca6590f846d4c29004b740ce" title="Loads the config, sets up the server and starts the main loop.">start_server()</a></code>, it does nothing.</p>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="server_8h.html">server.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
